<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <title>Digital Clock</title>
    <style>
      /* ê¸°ë³¸ ì´ˆê¸°í™” */
      body {
        background-color: #000000;
        margin: 0;
        padding: 10px;
        text-align: center;
      }

      html {
        height: 100%;
      }

      /* ì¤‘ì•™ ì»¨í…Œì´ë„ˆ */
      #container {
        height: 100%;
        width: 100%;
        /* êµ¬ë²„ì „ ë¸Œë¼ìš°ì €ì—ì„œ ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•œ í…Œì´ë¸” ë°©ì‹ */
        display: table;
      }

      .center-wrapper {
        display: table-cell;
        vertical-align: middle;
      }

      /* ì‹œê³„ ì˜ì—­ (íŒŒë€ìƒ‰ í° ê¸€ì”¨) */
      .clock-time {
        display: inline-block;
        font-family:
          "Helvetica Neue", Helvetica, Arial, sans-serif; /* í°íŠ¸ë¥¼ ëª…ì‹œí•˜ì—¬ ë“±í­ ìˆ«ì ì§€ì› ê°•í™” */
        font-variant-numeric: tabular-nums; /* ìˆ«ìì˜ ì¢Œìš° ë„ˆë¹„ë¥¼ ë™ì¼í•˜ê²Œ ë§ì¶¤ */
        color: #7daaf2; /* ì´ë¯¸ì§€ì˜ í•˜ëŠ˜ìƒ‰ê³¼ ìœ ì‚¬í•œ ìƒ‰ìƒ */
        font-size: 22vw; /* ë„“ì´ì— ë¹„ë¡€ */
        font-size: min(22vw, 300px); /* ìµœëŒ€ 300px ì œí•œ */
        line-height: 1;
        letter-spacing: -0.5vw; /* í­ ë¹„ìœ¨ì— ë§ì¶° ìê°„ ì§€ì • */
        vertical-align: top;
        margin-right: 2vw;
        font-weight: 900;
        white-space: nowrap; /* ì¤„ë°”ê¿ˆ ë°©ì§€ */
      }

      /* ë‚ ì§œ ë° ì˜¨ë„ ì˜ì—­ (ì˜¤ë¥¸ìª½ ì •ë³´) */
      .info-box {
        display: inline-block;
        text-align: left;
        vertical-align: top;
        padding-top: 20px; /* ì‹œê°„ ìˆ«ì ë†’ì´ì™€ ì‹œê°ì  ê· í˜• ë§ì¶¤ */
      }

      .date-text {
        color: #ffffff;
        font-size: 30px;
        font-weight: bold;
        margin-bottom: 10px;
        display: block;
      }

      .temp-text {
        color: #ffffff;
        font-size: 40px;
        font-weight: bold;
        display: block;
      }

      .aqi-text {
        color: #ffffff;
        font-size: 30px;
        font-weight: bold;
        display: block;
        margin-top: 10px;
      }

      .forecast-text {
        color: #dddddd;
        font-size: 20px;
        font-weight: normal;
        display: block;
        margin-top: 5px;
      }

      /* ê¹œë¹¡ì´ëŠ” ì½œë¡  íš¨ê³¼ (CSS ì›í˜• ì  ê·¸ë¦¬ê¸°) */
      .blink {
        display: inline-block;
        position: relative;
        width: 0.25em; /* ê¸€ì í¬ê¸°ì— ìƒëŒ€ì ìœ¼ë¡œ ì‚¬ì´ì¦ˆ ê²°ì • */
        height: 0.8em; /* ì»¨í…Œì´ë„ˆ ë†’ì´ë¥¼ ì¶©ë¶„íˆ í™•ë³´ */
        margin: 0 0.1em;
        vertical-align: middle;
        /* animation: blinker 1s linear infinite;
        -webkit-animation: blinker 1s linear infinite; */
      }

      /* ì í”„í•˜ëŠ” í˜„ìƒì„ ë§‰ê¸° ìœ„í•´ ë†’ì´ë¥¼ ì§ì ‘ ì§€ì •í•˜ì§€ ì•Šê³  ê°€ìƒìš”ì†Œë¡œ ë‘ ê°œì˜ ë™ê·¸ë¼ë¯¸ë¥¼ ê·¸ë¦¼ */
      .blink::before,
      .blink::after {
        content: "";
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        width: 15px;
        height: 15px;
        background-color: currentColor; /* ìƒìœ„ ìš”ì†Œì˜ ìƒ‰ìƒ ì‚¬ìš© */
        border-radius: 50%; /* ì™„ë²½í•œ ë™ê·¸ë¼ë¯¸ */
      }

      .blink::before {
        top: 10%; /* ìœ— ì  ìœ„ì¹˜ (ë” ìœ„ë¡œ) */
      }

      .blink::after {
        bottom: 30%; /* ì•„ë« ì  ìœ„ì¹˜ (ë” ì•„ë˜ë¡œ) */
      }

      @keyframes blinker {
        50% {
          opacity: 0;
        }
      }
      @-webkit-keyframes blinker {
        50% {
          opacity: 0;
        }
      }

      /* íŠ¹ë³„ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
      .special-message {
        font-size: 25px;
        color: #ff69b4; /* í•‘í¬ìƒ‰ í¬ì¸íŠ¸ */
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <div class="center-wrapper">
        <div class="date-text" id="dateDisplay">16ì¼ (ì›”)</div>
        <div
          class="clock-time"
          id="timeDisplay"
          onclick="toggleTimeFormat()"
          style="cursor: pointer"
        >
          10<span class="blink"></span>30<span class="blink"></span
          ><span style="font-variant-numeric: tabular-nums">00</span>
        </div>
        <div>
          <div class="aqi-text" id="aqiDisplay"></div>
          <div class="aqi-text" id="tomorrowAqiDisplay"></div>
        </div>
        <div id="specialMessage" class="special-message">ìœ¤ì€ì†” ì˜ˆìœì´</div>
      </div>
    </div>

    <script>
      // ES5 ë¬¸ë²• ì‚¬ìš© (êµ¬ë²„ì „ í˜¸í™˜)
      // 12ì‹œê°„ì œ í† ê¸€ ìƒíƒœ ë³€ìˆ˜
      var is12Hour = true;

      // Wake Lock (í™”ë©´ êº¼ì§ ë°©ì§€) ë³€ìˆ˜
      var wakeLock = null;

      async function requestWakeLock() {
        if ("wakeLock" in navigator) {
          try {
            wakeLock = await navigator.wakeLock.request("screen");
            console.log("Screen Wake Lock is active");

            // íƒ­ ë³€ê²½ ë“±ìœ¼ë¡œ í’€ë ¸ì„ ë•Œ ë‹¤ì‹œ ìš”ì²­í•˜ë„ë¡ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            document.addEventListener("visibilitychange", async function () {
              if (wakeLock !== null && document.visibilityState === "visible") {
                wakeLock = await navigator.wakeLock.request("screen");
              }
            });
          } catch (err) {
            console.log("Wake Lock request failed:", err.name, err.message);
          }
        }
      }

      function toggleTimeFormat() {
        is12Hour = !is12Hour;
        updateClock(); // ì¦‰ì‹œ ì—…ë°ì´íŠ¸ ë°˜ì˜
      }

      function updateClock() {
        var now = new Date();

        // ì‹œê°„ ì¶”ì¶œ
        var hours = now.getHours();

        // 12ì‹œê°„ì œ ì ìš© ì—¬ë¶€ ì²´í¬
        if (is12Hour) {
          hours = hours % 12;
          if (hours === 0) {
            hours = 12; // 0ì‹œëŠ” 12ì‹œë¡œ í‘œì‹œ (ì˜ˆ: ë°¤ 12ì‹œ = 12)
          }
        }
        var minutes = now.getMinutes();
        var seconds = now.getSeconds();

        // ë§¤ ì´ˆë§ˆë‹¤ ìƒ‰ìƒ ë³€ê²½ (ë°ì€ ìƒ‰ ê³„ì—´)
        var colors = [
          "#FF80AB",
          "#EA80FC",
          "#8C9EFF",
          "#80D8FF",
          "#A7FFEB",
          "#CCFF90",
          "#FFFF8D",
          "#FFD180",
        ];
        document.getElementById("timeDisplay").style.color =
          colors[seconds % colors.length];

        // 2ìë¦¬ ìˆ«ìë¡œ ë§ì¶”ê¸° (ì˜ˆ: 9 -> 09)
        hours = hours < 10 ? "0" + hours : hours;
        minutes = minutes < 10 ? "0" + minutes : minutes;
        var strSeconds = seconds < 10 ? "0" + seconds : seconds;

        // ì‹œê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
        var timeString =
          hours +
          '<span class="blink"></span>' +
          minutes +
          '<span class="blink"></span>' +
          '<span style="font-variant-numeric: tabular-nums;">' +
          strSeconds +
          "</span>";
        document.getElementById("timeDisplay").innerHTML = timeString;

        // ë‚ ì§œ ì¶”ì¶œ
        var date = now.getDate();
        date = date < 10 ? "0" + date : date;
        var month = now.getMonth() + 1;
        month = month < 10 ? "0" + month : month;
        var dayIndex = now.getDay();
        // ìš”ì¼ì— ë§ëŠ” ì•„ì´ì½˜ìœ¼ë¡œ ë³€ê²½
        // var dayNames = ["â˜€ï¸", "ğŸŒ™", "ğŸ”¥", "ğŸ’§", "ğŸŒ²", "ğŸ§ˆ", "ğŸª¨"];
        // var dayNames = ["â˜€ï¸", "ğŸŒ™", "âš”ï¸", "ğŸª", "âš¡", "â¤ï¸", "ğŸª"];
        var dayNames = ["â˜€ï¸", "ğŸŒ™", "ğŸ”¥âš”ï¸", "ğŸ’§ğŸªğŸŒ©ï¸", "ğŸŒ²âš¡", "ğŸ§ˆâ¤ï¸", "ğŸª"];
        var dayName = dayNames[dayIndex];

        // ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸
        // ìƒ‰ìƒ ê°•ì¡°ë¥¼ ìœ„í•´ ê´„í˜¸ ì•ˆ ìš”ì¼ì€ ë³„ë„ ìŠ¤íƒ€ì¼ë§ ê°€ëŠ¥í•˜ë‚˜ ì´ë¯¸ì§€ëŒ€ë¡œ í°ìƒ‰ ìœ ì§€
        var dateString =
          now.getFullYear() + "  " + month + "  " + date + "  " + dayName;
        document.getElementById("dateDisplay").innerHTML = dateString;

        // ë§¤ì‹œ 30ë¶„ 0ì´ˆ ~ 29ì´ˆ ë™ì•ˆ ë©”ì‹œì§€ í‘œì‹œ
        var messageDiv = document.getElementById("specialMessage");
        messageDiv.style.display = "block";
        if (minutes % 10 === 0) {
          if (minutes === 0) {
            messageDiv.innerHTML = "ìœ¤ì€ì†” ì˜ˆìœì´";
          }
          if (minutes === 10) {
            messageDiv.innerHTML = "ì´ë¯¼ì • ì˜ˆìœì´";
          }
          if (minutes === 20) {
            messageDiv.innerHTML = "ìœ¤ì€ì†”ì€ ìŠ¤í”Œë˜íˆ° ê³ ìˆ˜";
          }
          if (minutes === 30) {
            messageDiv.innerHTML = "ì´ë¯¼ì •ì€ ê³ ìˆ˜ë¥¼ ì¢‹ì•„í•´";
          }
          if (minutes === 40) {
            messageDiv.innerHTML = "ìœ¤ì€ì†”ì€ ì‘ê°€ ë°©êµ¬ ì¢‹ì•„í•´";
          }
          if (minutes === 50) {
            if (messageDiv.innerHTML.indexOf("ğŸ€") === -1) {
              var lotto = [];
              while (lotto.length < 6) {
                var num = Math.floor(Math.random() * 45) + 1;
                if (lotto.indexOf(num) === -1) {
                  lotto.push(num);
                }
              }
              lotto.sort(function (a, b) {
                return a - b;
              });
              messageDiv.innerHTML = "ğŸ€ " + lotto.join(", ");
            }
          }
          if (strSeconds === "00") {
            updateAQI();
          }
        } else {
          messageDiv.style.display = "none";
        }
      }

      function updateAQI() {
        var token = "c1611aa54ac7de2320cc3105b7b42a0ba2b26447";
        // 'here'ëŠ” IP ê¸°ë°˜ìœ¼ë¡œ í˜„ì¬ ìœ„ì¹˜ë¥¼ ìë™ìœ¼ë¡œ ì°¾ìŠµë‹ˆë‹¤.
        var url = "https://api.waqi.info/feed/here/?token=" + token;

        var xhr = new XMLHttpRequest();
        xhr.open("GET", url, true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {
            try {
              var response = JSON.parse(xhr.responseText);
              if (response.status === "ok") {
                var aqi = response.data.aqi;
                var statusText = "ğŸ˜„";
                if (aqi > 40) statusText = "ğŸ˜·";
                if (aqi > 80) statusText = "ğŸ¤¢";
                if (aqi > 100) statusText = "ğŸ‘¿";

                document.getElementById("aqiDisplay").innerHTML =
                  "ğŸ’¨ " + aqi + " " + statusText;

                // ì˜¤ëŠ˜ ì˜ˆë³´ (ìµœì €/ìµœê³ ) ê°€ì ¸ì˜¤ê¸°
                if (
                  response.data.forecast &&
                  response.data.forecast.daily &&
                  response.data.forecast.daily.pm25
                ) {
                  var forecasts = response.data.forecast.daily.pm25;
                  var now = new Date();
                  var year = now.getFullYear();
                  var month = now.getMonth() + 1;
                  var day = now.getDate();
                  if (month < 10) month = "0" + month;
                  if (day < 10) day = "0" + day;
                  var todayStr = year + "-" + month + "-" + day;

                  var tomorrow = new Date(now);
                  tomorrow.setDate(tomorrow.getDate() + 1);
                  var tYear = tomorrow.getFullYear();
                  var tMonth = tomorrow.getMonth() + 1;
                  var tDay = tomorrow.getDate();
                  if (tMonth < 10) tMonth = "0" + tMonth;
                  if (tDay < 10) tDay = "0" + tDay;
                  var tomorrowStr = tYear + "-" + tMonth + "-" + tDay;

                  for (var i = 0; i < forecasts.length; i++) {
                    if (forecasts[i].day === todayStr) {
                      document.getElementById("aqiDisplay").innerHTML =
                        "ğŸ’¨ " +
                        aqi +
                        " / " +
                        forecasts[i].max +
                        " " +
                        statusText;
                    }
                    if (forecasts[i].day === tomorrowStr) {
                      var tomorrowAQI = forecasts[i].max;
                      var tomorrowStatusText = "ğŸ˜„";
                      if (tomorrowAQI > 40) tomorrowStatusText = "ğŸ˜·";
                      if (tomorrowAQI > 80) tomorrowStatusText = "ğŸ¤¢";
                      if (tomorrowAQI > 100) tomorrowStatusText = "ğŸ‘¿";

                      document.getElementById("tomorrowAqiDisplay").innerHTML =
                        "â­ï¸ ğŸ’¨ / " + tomorrowAQI + " " + tomorrowStatusText;
                    }
                  }
                }
              }
            } catch (e) {
              console.log("AQI Error");
            }
          }
        };
        xhr.send();
      }

      // 1ì´ˆë§ˆë‹¤ ì‹¤í–‰
      setInterval(updateClock, 1000);

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¦‰ì‹œ ì‹¤í–‰
      updateClock();
      updateAQI();
      // 30ë¶„ë§ˆë‹¤ ë¯¸ì„¸ë¨¼ì§€ ì •ë³´ ê°±ì‹ 
      //   setInterval(updateAQI, 1800000);
      // ë¸Œë¼ìš°ì € í™”ë©´ êº¼ì§ ë°©ì§€ ìš”ì²­ (ì§€ì›ë˜ëŠ” ê¸°ê¸°ì—ì„œë§Œ ì‘ë™)
      requestWakeLock();
    </script>
  </body>
</html>
